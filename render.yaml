services:
  - type: web
    name: dll-iems
    env: ruby
    repo: https://github.com/Aizen-25/DLL-IEMS
    branch: main
    buildCommand: bundle install
    # Start the app. Run migrations separately via the one-off job to avoid deploy-time failures.
    startCommand: bundle exec rackup config.ru -p $PORT
    # Health check path for Render
    healthCheckPath: /health
    envVars:
      - key: RACK_ENV
        value: production
  - type: job
    name: dll-iems-migrate
    env: ruby
    # Use the migration helper script; this can be run as a one-off or scheduled in Render UI
    command: bash ./bin/migrate
    plan: free
    description: "Run database migrations (one-off job); can be scheduled in Render UI if desired."